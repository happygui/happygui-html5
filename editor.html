<!DOCTYPE html>
<html>
<head>
  <title>HappyGUI</title>
  <link rel="stylesheet" type="text/css" href="css/default.css" />
</head>
<body>
<div class="wrapper">
  <div id="editor">
    <a href="#new">Go</a>
    <!-- editorViews will be imported here -->
  </div>

  <div id="preview">
    <!-- elements drawn by the user -->
  </div>
</div>

<script type="text/javascript" src="js/handlebars.js"></script>
<script type="text/javascript" src="build/build.js"></script>

<script id="editor_tpl" type="text/html">
  <header>
    <div class="colorpicker cpBackground" style="background-color: {{backgroundColor}};">
    </div>
  </header>

  <section>
  </section>

  <footer>

  </footer>

</script>

<script id="element_editor_tpl" type="text/html">
  <header>

  </header>

  <section>
    {{#hasBackground}}
    <div class="colorpicker cpBackground" style="background-color: {{backgroundColor}};">
    </div>
    {{/hasBackground}}
    {{#hasBorderColor}}
    <div class="colorpicker cpBorderColor" style="background-color: {{borderColor}};">
    </div>
    {{/hasBorderColor}}
    {{#hasFontColor}}
    <div class="colorpicker cpFontColor" style="background-color: {{fontColor}};">
    </div>
    {{/hasFontColor}}
    {{#hasBorderThickness}}
    <div class="sizemodifier smBorderThickness">
      <label>Border thickness<input value="{{borderThickness}}" name="smBorderThickness" /></label>
    </div>
    {{/hasBorderThickness}}
    {{#hasFontSize}}
    <div class="sizemodifier smFontSize">
      <label>Font size<input value="{{fontSize}}" name="smFontSize" /></label>
    </div>
    {{/hasFontSize}}
  </section>

  <footer>
    {{#isDeletable}}
    <button class="btn-editor btn-delete">Delete</button>
    {{/isDeletable}}
  </footer>

</script>

<script type="text/javascript">
  var Router = require('apily-router');

  var Templates = new function() {
    this.compile = function(doc) {
      return Handlebars.compile(doc.innerHTML);
    };
    this.editor = this.compile(document.getElementById('editor_tpl'));
    this.element_editor = this.compile(document.getElementById('element_editor_tpl'));
  };

  function EditorView (options) {
    options = options || {};

    this.element = options.element;
    this.container = options.container;
    this.hidden = false;

    return this;
  }

  EditorView.prototype.el = function(html) {
    document.getElementById(this.container || 'editor').innerHTML = html;

    return this;
  };

  EditorView.prototype.select = function(element) {
    this.element = element || null;

    console.log("EditorView#select ", this.element);

    return this;
  };

  EditorView.prototype.show = function() {
    if (this.hidden == true) {
      this.hidden = false;
      document.getElementById(this.container || 'editor').className = "";
    }

    console.log("EditorView#show", this.hidden);

    return this;
  };

  EditorView.prototype.hide = function() {
    if (this.hidden == false) {
      this.hidden = true;
      document.getElementById(this.container || 'editor').className = "hidden";
    }

    console.log("EditorView#hide", this.hidden);

    return this;
  };

  EditorView.prototype.render = function () {
    var html, data;

    if (this.element) {
      data = {name: "Hello"};
      html = Templates.element_editor(data);
      console.log("rendering element_editor", this.element);
    } else {
      data = {name: "ciao"};
      html = Templates.editor(data);
      console.log("rendering editor", this.element);
    }

    this.el(html).show();

    return this;
  };

  var editorView = new EditorView();


  // Element Class
  function Element(options) {
    this.isDeletable = options.isDeletable;
  }

  // TextElement Class
  var TextElement = function(options) {
    Element.call(this, options); // Super

    this.hasFontSize = true;
    this.hasFontColor = true;

    this.fontSize = "13px";
    this.fontColor = "#000";
  };
  TextElement.prototype = Object.create(Element.prototype);
  TextElement.prototype.constructor = TextElement;

  // TextElement Class
  var ShapeElement = function(options) {
    Element.call(this, options); // Super

    this.hasBorderColor = true;
    this.hasBorderThickness = true;
    this.hasBackgroundColor = true;

    this.borderColor = "#cc0000";
    this.borderThickness = "5px";
    this.backgroundColor = "#00cc00";
  };
  ShapeElement.prototype = Object.create(Element.prototype);
  ShapeElement.prototype.constructor = ShapeElement;

  // r is handler for routing
  var Views = {
    homepage: function() {
      editorView
          .hide();
      console.log("YUHU WE ARE IN HOMEPAGE");
    },
    newpage: function() {
      editorView
          .hide();
      console.log("YUHU WE ARE IN NEWPAGE");
    },
    editor: function() {
      editorView
          .select(null)
          .render();
      console.log("YUHU WE ARE IN editor");
    },
    help: function() {
      editorView
          .hide();

      console.log("YUHU WE ARE IN help");
    },
    collection: function() {
      editorView
          .hide();

      console.log("YUHU WE ARE IN collection");
    },
    element_editor: function(type) {
      editorView
          .select({type: type, id: null})
          .render();

      console.log("YUHU WE ARE IN editor:"+type);
    }
  };

  // router is the app route
  var router = new Router()
      .route('#homepage', Views.homepage)
      .route('#new', Views.newpage)
      .route('#editor', Views.editor)
      .route("#help", Views.help)
      .route("#collection", Views.collection)
      .route('#editor/:type', Views.element_editor);

  // starting history
  router.history.start();

  // set the page on #homepage onload
  if (window.location.hash === "") {
    window.location = "#homepage";
  }

</script>

</body>
</html>